<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebAR Demo — Галерея мебели</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root { --bg:#0b0f17; --fg:#e6e9f2; --muted:#9aa3b2; --card:#121826; --accent:#7cd4fd; --ok:#5dd39e; --err:#ff6b6b; }
    body{margin:0; font-family: system-ui, sans-serif; background:var(--bg); color:var(--fg);}    
    .wrap{max-width:1100px; margin:0 auto; padding:24px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0;}
    .brand{font-weight:700;}
    .card{background:var(--card); border-radius:20px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35);}    
    model-viewer{width:100%; height:70vh; background: radial-gradient(1200px 600px at 50% 0%, rgba(124,212,253,.08), rgba(0,0,0,0)); border-radius:16px;}
    .gallery{display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:12px;}
    .thumb{cursor:pointer; padding:8px; border-radius:14px; border:1px solid #273149; background:#111827; text-align:center;}
    .thumb:hover{border-color:var(--accent)}
    .thumb img{width:100%; border-radius:10px; display:block}
    .thumb span{display:block; margin-top:6px; font-size:.9rem; color:var(--muted);}    
    .btn{cursor:pointer; padding:10px 14px; border-radius:12px; background:var(--accent); color:#07131b; font-weight:600; margin:4px; border:none;}
    .btn.secondary{background:#1b2539; color:var(--fg); border:1px solid #273149}
    .hint{color:var(--muted); font-size:.9rem}
    .drop{border:1px dashed #2a3550; border-radius:14px; padding:10px; text-align:center; margin-top:10px}
    .kbd{font-family: monospace; background:#1b2539; border:1px solid #273149; padding:0 6px; border-radius:6px}
    .tests{margin-top:18px; border-top:1px solid #273149; padding-top:12px}
    .test-result{padding:6px 10px; border-radius:10px; background:#101725; border:1px solid #273149; margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">WebAR Demo · Галерея мебели</div>
      <div class="hint">Загружайте свои модели локально, если нет хостинга.</div>
    </header>

    <div class="card">
      <!-- Галерея -->
      <div class="gallery">
        <!-- Демо-модель (Astronaut, всегда работает) -->
        <div class="thumb" onclick="loadModel('https://modelviewer.dev/shared-assets/models/Astronaut.glb','https://modelviewer.dev/shared-assets/models/Astronaut.usdz','Демо (Astronaut)')">
          <img alt="Демо превью" src="https://modelviewer.dev/shared-assets/models/thumbnails/Astronaut.webp">
          <span>Демо (надежно)</span>
        </div>

        <!-- Кресло: выбор файла -->
        <label class="thumb">
          <input id="fileGlb" type="file" accept=".glb,.gltf" hidden>
          <input id="fileUsdz" type="file" accept=".usdz" hidden>
          <img alt="Кресло превью" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='180'><rect width='100%' height='100%' rx='14' fill='%231d2740'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%239aa3b2' font-family='Arial' font-size='16'>Загрузить кресло</text></svg>">
          <span>Кресло (загрузить)</span>
          <div>
            <button class="btn secondary" type="button" onclick="document.getElementById('fileGlb').click()">GLB</button>
            <button class="btn secondary" type="button" onclick="document.getElementById('fileUsdz').click()">USDZ</button>
          </div>
        </label>

        <!-- Плейсхолдеры -->
        <div class="thumb"><img alt="Стол" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='180'><rect width='100%' height='100%' rx='14' fill='%23161d31'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23778796' font-family='Arial' font-size='16'>Стол (скоро)</text></svg>"><span>Стол (скоро)</span></div>
        <div class="thumb"><img alt="Диван" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='180'><rect width='100%' height='100%' rx='14' fill='%23161d31'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23778796' font-family='Arial' font-size='16'>Диван (скоро)</text></svg>"><span>Диван (скоро)</span></div>
      </div>

      <!-- Viewer -->
      <model-viewer id="viewer"
        src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
        ios-src="https://modelviewer.dev/shared-assets/models/Astronaut.usdz"
        alt="Демо (Astronaut)"
        ar ar-modes="quick-look scene-viewer webxr"
        camera-controls auto-rotate
        shadow-intensity="1">
        <button class="btn" slot="ar-button">Показать в комнате</button>
      </model-viewer>

      <!-- Drag & Drop -->
      <div id="dropZone" class="drop">Перетащите сюда <span class="kbd">.glb</span> или <span class="kbd">.usdz</span></div>

      <!-- Тесты -->
      <div class="tests">
        <button class="btn" onclick="runTestDemo()">Тест 1: Демо модель</button>
        <button class="btn" onclick="runTestLocal()">Тест 2: Локальная модель</button>
        <div id="testResults"></div>
      </div>
    </div>
  </div>

<script>
  const viewer = document.getElementById('viewer');
  const fileGlb = document.getElementById('fileGlb');
  const fileUsdz = document.getElementById('fileUsdz');
  const dropZone = document.getElementById('dropZone');
  const testResults = document.getElementById('testResults');

  function loadModel(glb, usdz, title){
    viewer.src = glb;
    viewer.iosSrc = usdz;
    viewer.alt = title;
  }

  fileGlb.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
      viewer.src = URL.createObjectURL(file);
    }
  });

  fileUsdz.addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
      viewer.iosSrc = URL.createObjectURL(file);
    }
  });

  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.borderColor = '#7cd4fd'; });
  dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.style.borderColor = '#2a3550'; });
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.style.borderColor = '#2a3550';
    for(const file of e.dataTransfer.files){
      if(file.name.endsWith('.glb')||file.name.endsWith('.gltf')){
        viewer.src = URL.createObjectURL(file);
      }
      if(file.name.endsWith('.usdz')){
        viewer.iosSrc = URL.createObjectURL(file);
      }
    }
  });

  // Тесты
  function runTestDemo(){
    testResults.innerHTML += `<div class='test-result'>Демо модель загружена: ${viewer.src.includes('Astronaut')?'OK':'FAIL'}</div>`;
  }
  function runTestLocal(){
    testResults.innerHTML += `<div class='test-result'>Локальная модель: ${viewer.src.startsWith('blob:')?'OK':'FAIL'}</div>`;
  }
</script>
</body>
</html>
